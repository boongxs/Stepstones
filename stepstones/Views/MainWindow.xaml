<Window x:Class="stepstones.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:stepstones" 
        xmlns:viewmodels="clr-namespace:stepstones.ViewModels"
        xmlns:views="clr-namespace:stepstones.Views"
        d:DataContext="{d:DesignInstance Type=viewmodels:MainViewModel}"
        mc:Ignorable="d"
        Title="MainWindow" 
        Height="650" 
        Width="1000"
        WindowState="Maximized"
        Background="#282828"
        MinWidth="700"
        MinHeight="600"
        Icon="/Resources/Icons/stepstones.ico">

    <Grid x:Name="MainGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Title Label -->
        <Label Grid.Row="0"
               Content="Stepstones"
               HorizontalAlignment="Center"
               VerticalAlignment="Center"
               FontSize="90"
               Foreground="#f0f0f0">
        </Label>

        <!-- Filtering TextBox -->
        <TextBox Grid.Row="1"
                 Text="{Binding FilterText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                 HorizontalAlignment="Center"
                 VerticalAlignment="Center"
                 Width="600"
                 Height="72"
                 Background="#303030"
                 Foreground="#f0f0f0"
                 CaretBrush="#f0f0f0"
                 BorderThickness="0"
                 FontSize="32"
                 VerticalContentAlignment="Center"
                 Margin="0,20,0,20"
                 Padding="10,0,0,0">
        </TextBox>

        <!-- General buttons -->
        <StackPanel Grid.Row="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Margin="0,0,0,10">
            <Button Command="{Binding SelectFolderCommand}"
                    Style="{StaticResource StackPanelButtonStyle}">
                <Image Source="/Resources/Icons/select_folder.png"
                       Width="35"
                       Height="35">
                </Image>
            </Button>

            <Button Command="{Binding UploadFilesCommand}"
                    Style="{StaticResource StackPanelButtonStyle}">
                <Image Source="/Resources/Icons/upload.png"
                       Width="35"
                       Height="35">
                </Image>
            </Button>

            <Button Content="&lt;&lt;"
                    Command="{Binding GoToFirstPageCommand}"
                    Style="{StaticResource StackPanelButtonStyle}"
                    Margin="20, 5, 5, 5"
                    FontSize="18"
                    FontWeight="UltraBold">
            </Button>
            
            <Button Content="&lt;"
                    Command="{Binding GoToPreviousPageCommand}"
                    Style="{StaticResource StackPanelButtonStyle}"
                    Margin="5,5,10,5"
                    FontSize="18"
                    FontWeight="UltraBold">
            </Button>

            <TextBlock Text="{Binding PageInfo}"
                       Foreground="White"
                       FontSize="16"
                       VerticalAlignment="Center">
            </TextBlock>

            <Button Content="&gt;"
                    Command="{Binding GoToNextPageCommand}"
                    Style="{StaticResource StackPanelButtonStyle}"
                    Margin="10,5,5,5"
                    FontSize="18"
                    FontWeight="UltraBold">
            </Button>

            <Button Content="&gt;&gt;"
                    Command="{Binding GoToLastPageCommand}"
                    Style="{StaticResource StackPanelButtonStyle}"
                    FontSize="18"
                    FontWeight="UltraBold">
            </Button>
        </StackPanel>

        <!-- ItemsControl to display the media items -->
        <ScrollViewer x:Name="MainScrollViewer"
                      Grid.Row="3"
                      Margin="20,0,20,20"
                      VerticalScrollBarVisibility="Auto">
            <ItemsControl x:Name="MediaItemsControl"
                          ItemsSource="{Binding MediaItems}"
                          SizeChanged="MediaItemsControl_SizeChanged"
                          VerticalAlignment="Top">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <UniformGrid Columns="{Binding GridColumns}"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.Resources>
                    <DataTemplate DataType="{x:Type viewmodels:MediaItemViewModel}">
                        <Grid x:Name="ItemContainer"
                              Margin="5"
                              Height="250"
                              Background="#404040">
                            <!-- Layer 1: Placeholder border -->
                            <Border Background="#404040"/>

                            <!-- Layer 2: Thumbnail -->
                            <Image Source="{Binding ThumbnailImage}"
                                   Stretch="UniformToFill">
                            </Image>

                            <!-- Layer 3: Darkening overlay -->
                            <Border Background="#80000000">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Opacity" Value="0"/>
                                        <Setter Property="IsHitTestVisible" Value="False"/>

                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsMouseOver, ElementName=ItemContainer}"
                                                         Value="True">
                                                <Setter Property="Opacity" Value="1"/>
                                                <Setter Property="IsHitTestVisible" Value="True"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                            </Border>

                            <!-- Layer 4: Command buttons overlay -->
                            <Grid>
                                <Grid.Style>
                                    <Style TargetType="Grid">
                                        <Setter Property="Opacity" Value="0"/>
                                        <Setter Property="IsHitTestVisible" Value="False"/>

                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsMouseOver, ElementName=ItemContainer}"
                                                         Value="True">
                                                <Setter Property="Opacity" Value="1"/>
                                                <Setter Property="IsHitTestVisible" Value="True"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Grid.Style>

                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <Button Grid.Row="0"
                                        Grid.Column="0"
                                        Style="{StaticResource QuadrantIconButtonStyle}"
                                        Command="{Binding CopyCommand}"
                                        Tag="/Resources/Icons/copy.png"
                                        Content="/Resources/Icons/copy-hover.png">
                                </Button>

                                <Button Grid.Row="0"
                                        Grid.Column="1"
                                        Style="{StaticResource QuadrantIconButtonStyle}"
                                        Command="{Binding TagsCommand}"
                                        Tag="/Resources/Icons/edit.png"
                                        Content="/Resources/Icons/edit-hover.png">
                                </Button>

                                <Button Grid.Row="1"
                                        Grid.Column="0"
                                        Style="{StaticResource QuadrantIconButtonStyle}"
                                        Command="{Binding EnlargeCommand}"
                                        Tag="/Resources/Icons/enlarge.png"
                                        Content="/Resources/Icons/enlarge-hover.png">
                                </Button>

                                <Button Grid.Row="1"
                                        Grid.Column="1"
                                        Style="{StaticResource QuadrantIconButtonStyle}"
                                        Command="{Binding DeleteCommand}"
                                        Tag="/Resources/Icons/delete.png"
                                        Content="/Resources/Icons/delete-hover.png">
                                </Button>
                            </Grid>
                        </Grid>
                    </DataTemplate>

                    <DataTemplate DataType="{x:Type viewmodels:PlaceholderViewModel}">
                        <Grid Margin="5"
                              Height="250"
                              Background="#404040">
                            <TextBlock Text="Loading..."
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       Foreground="White">
                            </TextBlock>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.Resources>
            </ItemsControl>
        </ScrollViewer>

        <!-- Enlarge and EditTags button's Overlay -->
        <views:DialogHost Grid.Row="0"
                          Grid.RowSpan="4">
        </views:DialogHost>
    </Grid>
</Window>
