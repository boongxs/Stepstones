<views:MediaPlayerViewBase x:Class="stepstones.Views.EnlargeVideoView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:viewmodels="clr-namespace:stepstones.ViewModels"
             xmlns:views="clr-namespace:stepstones.Views"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=viewmodels:EnlargeVideoViewModel}"
             d:DesignHeight="450" d:DesignWidth="800">
    <Grid Background="Transparent"
          Margin="20"
          HorizontalAlignment="Center"
          VerticalAlignment="Center">
        <Viewbox x:Name="VideoViewbox"
                 Stretch="Uniform"
                 StretchDirection="DownOnly">
            <Grid Width="{Binding LayoutWidth}"
                  Height="{Binding LayoutHeight}">
                <MediaElement x:Name="MediaPlayer"
                              LoadedBehavior="Manual"
                              UnloadedBehavior="Close"
                              Source="{Binding PlayableFileUri}"
                              Stretch="Fill"
                              Volume="0.5"
                              MediaEnded="MediaPlayer_MediaEnded">
                </MediaElement>
            </Grid>
        </Viewbox>

        <Grid x:Name="ControlsContainer"
              Width="{Binding ElementName=VideoViewbox, Path=ActualWidth}"
              Height="{Binding ElementName=VideoViewbox, Path=ActualHeight}">
            <TextBlock Text="Preparing video for playback..."
                       Foreground="White"
                       FontSize="18"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Collapsed"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsTranscoding}"
                                         Value="True">
                                <Setter Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>

            <Grid IsHitTestVisible="False">
                <ContentControl x:Name="PlayIndicator"
                                Template="{StaticResource PlayIndicatorTemplate}"
                                Visibility="Collapsed">
                </ContentControl>

                <ContentControl x:Name="PauseIndicator"
                                Template="{StaticResource PauseIndicatorTemplate}"
                                Visibility="Collapsed">
                </ContentControl>
            </Grid>

            <Border x:Name="ControlsOverlay"
                    VerticalAlignment="Bottom"
                    Background="#cc000000"
                    Height="50"
                    MouseLeftButtonDown="ControlsOverlay_MouseLeftButtonDown">
                <Grid>
                    <Button HorizontalAlignment="Left"
                            Padding="10,0,10,0"
                            Click="PlayPauseButton_Click"
                            Style="{StaticResource TransparentButtonStyle}">
                        <Path x:Name="PlayPauseIcon"
                              Fill="#a0a0a1"
                              Stretch="Uniform"
                              Width="25"
                              Height="25">
                            <Path.Style>
                                <Style TargetType="Path">
                                    <Setter Property="Data" Value="{StaticResource PlayIconData}"/>

                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsPlaying, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                     Value="True">
                                            <Setter Property="Data" Value="{StaticResource PauseIconData}"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Path.Style>
                        </Path>
                    </Button>

                    <Grid x:Name="VolumeControlContainer"
                          HorizontalAlignment="Right"
                          Background="Transparent"
                          Margin="0,0,5,0"
                          MouseEnter="VolumeControlContainer_MouseEnter"
                          MouseLeave="VolumeControlContainer_MouseLeave">
                        <Popup x:Name="VolumePopup"
                               Placement="Top"
                               PlacementTarget="{Binding ElementName=MuteButton}"
                               StaysOpen="True"
                               AllowsTransparency="True"
                               HorizontalOffset="8"
                               VerticalOffset="-5">
                            <Border Background="#444444"
                                    Padding="5"
                                    CornerRadius="10"
                                    MouseEnter="VolumePopup_MouseEnter"
                                    MouseLeave="VolumePopup_MouseLeave">
                                <Slider x:Name="VolumeSlider"
                                        Style="{StaticResource VerticalVolumeSliderStyle}"
                                        Orientation="Vertical"
                                        Height="100"
                                        Minimum="0"
                                        Maximum="1"
                                        Value="{Binding Volume, ElementName=MediaPlayer, Mode=TwoWay}"
                                        ValueChanged="VolumeSlider_ValueChanged"
                                        PreviewMouseLeftButtonDown="VolumeSlider_PreviewMouseLeftButtonDown"
                                        PreviewMouseMove="VolumeSlider_PreviewMouseMove"
                                        PreviewMouseLeftButtonUp="VolumeSlider_PreviewMouseLeftButtonUp">
                                </Slider>
                            </Border>
                        </Popup>

                        <Button x:Name="MuteButton"
                                Width="30"
                                Height="30"
                                Click="MuteButton_Click"
                                Style="{StaticResource MuteButtonStyle}"
                                Margin="0,0,5,3">
                        </Button>
                    </Grid>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</views:MediaPlayerViewBase>
